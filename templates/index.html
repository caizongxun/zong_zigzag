<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZigZag å¯¦æ™‚é æ¸¬ - æ©Ÿå™¨å­¸ç¿’äº¤æ˜“ä¿¡è™Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .config-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.95em;
        }

        select, input {
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-predict {
            background: #667eea;
            color: white;
        }

        .btn-predict:hover {
            background: #5a67d8;
            transform: scale(1.02);
        }

        .btn-predict:active {
            transform: scale(0.98);
        }

        .btn-start {
            background: #48bb78;
            color: white;
        }

        .btn-start:hover {
            background: #38a169;
        }

        .btn-stop {
            background: #f56565;
            color: white;
        }

        .btn-stop:hover {
            background: #e53e3e;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-badge.ok {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-badge.loading {
            background: #bee3f8;
            color: #2c5282;
            animation: pulse 1.5s infinite;
        }

        .status-badge.error {
            background: #fed7d7;
            color: #742a2a;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .prediction-display {
            text-align: center;
        }

        .signal-badge {
            font-size: 2.5em;
            font-weight: bold;
            padding: 30px 40px;
            border-radius: 12px;
            margin: 20px 0;
            display: inline-block;
            min-width: 200px;
            color: white;
            transition: all 0.3s;
        }

        .signal-badge.HH {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .signal-badge.HL {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .signal-badge.LH {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .signal-badge.LL {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .signal-badge.HOLD {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
        }

        .confidence-meter {
            margin: 20px 0;
        }

        .confidence-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .confidence-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #ddd;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .data-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .data-item label {
            display: block;
            font-size: 0.85em;
            color: #718096;
            margin-bottom: 5px;
        }

        .data-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3748;
            font-family: 'Courier New', monospace;
        }

        .probabilities {
            margin-top: 20px;
        }

        .prob-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f7fafc;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .prob-item .label {
            font-weight: 600;
            color: #555;
        }

        .prob-item .percentage {
            font-weight: bold;
            color: #667eea;
            font-family: 'Courier New', monospace;
        }

        .timestamp {
            font-size: 0.85em;
            color: #999;
            text-align: center;
            margin-top: 15px;
            border-top: 1px solid #e0e0e0;
            padding-top: 15px;
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #f56565;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #48bb78;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .config-section {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .data-grid {
                grid-template-columns: 1fr;
            }
        }

        .signal-animation {
            animation: signalPulse 0.5s ease-in-out;
        }

        @keyframes signalPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é é¢ä¸€ -->
        <div class="header">
            <h1>âš¡ ZigZag å¯¦æ™‚é æ¸¬</h1>
            <p>æ©Ÿå™¨å­¸ç¿’äº¤æ˜“ä¿¡è™Ÿ â€¢ å³æ™‚å¸‚å ´åˆ†æ</p>
        </div>

        <!-- é©å²çµ±é» - å¯é…ç½® -->
        <div class="main-grid">
            <!-- å±ˆä¸€å¡ç‰‡: é…ç½®é„¦ -->
            <div class="card">
                <h2>æˆä¸é…ç½®</h2>
                <div class="config-section">
                    <div class="form-group">
                        <label>äº¤æ˜“å°</label>
                        <select id="pair">
                            <option value="BTCUSDT">Bitcoin (BTC)</option>
                            <option value="ETHUSDT">Ethereum (ETH)</option>
                            <option value="BNBUSDT">Binance Coin (BNB)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ™‚é–“æ¡†æ¶</label>
                        <select id="interval">
                            <option value="15m" selected>15 åˆ†é˜</option>
                            <option value="1h">1 å°æ™‚</option>
                            <option value="4h">4 å°æ™‚</option>
                            <option value="1d">1 å¤©</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-predict" onclick="predictNow()">ğŸ• é©—ç­¡ä¸€è‡º</button>
                    <button class="btn-start" onclick="startAutoUpdate()">â–¶ é–‹å§‹è‡ªå‹•</button>
                    <button class="btn-stop" onclick="stopAutoUpdate()">â¹ åœæ­¢</button>
                </div>

                <div id="statusMessage"></div>
            </div>

            <!-- å±ˆäºŒå¡ç‰‡: ä¼çµ² -->
            <div class="card">
                <h2>ç³»çµ±ç‹€æ…‹</h2>
                <div class="data-grid">
                    <div class="data-item">
                        <label>æ¨¡å‹</label>
                        <div class="value" id="modelStatus">ğŸ” åŠ è¼‰ä¸­...</div>
                    </div>
                    <div class="data-item">
                        <label>ä¸Šæ¬¡æ›´æ–°</label>
                        <div class="value" id="lastUpdate">--:--:--</div>
                    </div>
                    <div class="data-item">
                        <label>é æ¸¬æ¬¡æ•¸</label>
                        <div class="value" id="predictionCount">0</div>
                    </div>
                    <div class="data-item">
                        <label>è‡ªå‹•æ›´æ–°</label>
                        <div class="value" id="autoUpdateStatus">âš ï¸ å·²åœæ­¢</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é©å²çµ±é» - é æ¸¬çµæœ -->
        <div class="card">
            <h2>æœ€æ–°é æ¸¬çµæœ</h2>
            <div class="prediction-display">
                <div id="signalDisplay" class="signal-badge HOLD">âš  HOLD</div>
                
                <div class="confidence-meter">
                    <div class="confidence-label">
                        <span>ç½®ä¿¡åº¦</span>
                        <span id="confidencePercent">0%</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidenceFill" style="width: 0%">
                            <span id="confidenceText">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸€å¯¦æ™‚æ•¸æ“š -->
            <div class="data-grid" id="ohlcvData" style="display: none;">
                <div class="data-item">
                    <label>é–‹ä»²åƒ¹</label>
                    <div class="value" id="openPrice">--</div>
                </div>
                <div class="data-item">
                    <label>æ”¶ç›¤åƒ¹</label>
                    <div class="value" id="closePrice">--</div>
                </div>
                <div class="data-item">
                    <label>æœ€é«˜åƒ¹</label>
                    <div class="value" id="highPrice">--</div>
                </div>
                <div class="data-item">
                    <label>æœ€ä½åƒ¹</label>
                    <div class="value" id="lowPrice">--</div>
                </div>
            </div>

            <!-- æ‰€æœ‰ç­–ç•¥æ¨™ç±¤çš„æ©Ÿç‡ -->
            <div class="probabilities" id="probabilitiesDisplay" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #555;">Swing Type æ©Ÿç‡åˆ†ä½ˆ</h3>
                <div id="probsList"></div>
            </div>

            <!-- æ™‚é–“æˆ³ -->
            <div class="timestamp" id="timestamp"></div>

            <!-- éŒ¯èª¤/æˆåŠŸæç¤º -->
            <div id="messageDisplay"></div>
        </div>
    </div>

    <script>
        let predictionCount = 0;
        let autoUpdateInterval = null;
        let isAutoUpdating = false;

        // çµ±çš„é¡é †ç­–ç•¥é¡¾è‰²ï¼ˆå¯ä¸è¨­ç½®ï¼‰
        const signalColors = {
            'HH': { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', text: 'white' },
            'HL': { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', text: 'white' },
            'LH': { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', text: 'white' },
            'LL': { bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', text: 'white' },
            'HOLD': { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', text: '#333' }
        };

        // æ›´æ–°æ™‚é–“æˆ³
        function updateTimestamp() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('timestamp').textContent = `ä¸Šæ¬¡æ›´æ–°: ${hours}:${minutes}:${seconds}`;
        }

        // åªæ›´æ–°æ•¸å­—ï¼Œä¸æ›´æ–°æ–‡å­—ï¼ˆé¿äºé—œé—Šï¼‰
        function updatePrediction(data) {
            if (!data.data) return;

            const pred = data.data;
            predictionCount++;

            // 1. æ›´æ–°ä¿¡è™Ÿä¸ç‰±æ”¹æ–¸è©®æ¨™é…Œ
            const signal = pred.signal || 'HOLD';
            const signalElement = document.getElementById('signalDisplay');
            
            // æª¢æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ä¿¡è™Ÿ
            if (!signalElement.textContent.includes(signal)) {
                signalElement.textContent = signal;
                signalElement.className = `signal-badge ${signal} signal-animation`;
            }

            // 2. æ›´æ–°ç½®ä¿¡åº¦ (åƒ…æ•¸å­—)
            const confidence = (pred.confidence * 100).toFixed(1);
            const confidenceText = document.getElementById('confidencePercent');
            if (confidenceText.textContent !== `${confidence}%`) {
                confidenceText.textContent = `${confidence}%`;
            }

            // 3. æ›´æ–°ç½®ä¿¡åº¦æ¡ (åªæ’æ›å¯¶å¯¶)
            const fill = document.getElementById('confidenceFill');
            fill.style.width = `${confidence}%`;
            const fillText = document.getElementById('confidenceText');
            if (fillText.textContent !== `${confidence}%`) {
                fillText.textContent = `${confidence}%`;
            }

            // 4. æ›´æ–° OHLCV æ•¸æ“š (åƒ…æ•¸å­—)
            if (pred.ohlcv) {
                document.getElementById('ohlcvData').style.display = 'grid';
                
                const openPrice = pred.ohlcv.open.toFixed(2);
                const openEl = document.getElementById('openPrice');
                if (openEl.textContent !== openPrice) {
                    openEl.textContent = openPrice;
                }

                const closePrice = pred.ohlcv.close.toFixed(2);
                const closeEl = document.getElementById('closePrice');
                if (closeEl.textContent !== closePrice) {
                    closeEl.textContent = closePrice;
                }

                const highPrice = pred.ohlcv.high.toFixed(2);
                const highEl = document.getElementById('highPrice');
                if (highEl.textContent !== highPrice) {
                    highEl.textContent = highPrice;
                }

                const lowPrice = pred.ohlcv.low.toFixed(2);
                const lowEl = document.getElementById('lowPrice');
                if (lowEl.textContent !== lowPrice) {
                    lowEl.textContent = lowPrice;
                }
            }

            // 5. æ›´æ–°æ¨™ç±¤æ©Ÿç‡ (åƒ…æ•¸å­—)
            if (pred.all_probabilities) {
                document.getElementById('probabilitiesDisplay').style.display = 'block';
                const probsList = document.getElementById('probsList');
                probsList.innerHTML = '';
                
                for (const [label, prob] of Object.entries(pred.all_probabilities)) {
                    const probPercent = (prob * 100).toFixed(1);
                    const probItem = document.createElement('div');
                    probItem.className = 'prob-item';
                    probItem.innerHTML = `
                        <span class="label">${label}</span>
                        <span class="percentage">${probPercent}%</span>
                    `;
                    probsList.appendChild(probItem);
                }
            }

            // 6. æ›´æ–°çµ±è¨ˆæ•¸æ¥ (åƒ…æ•¸å­—)
            const countEl = document.getElementById('predictionCount');
            if (countEl.textContent !== String(predictionCount)) {
                countEl.textContent = predictionCount;
            }

            // 7. æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“ (åƒ…æ•¸å­—)
            updateTimestamp();
        }

        // å–å¾—é æ¸¬
        async function predictNow() {
            const pair = document.getElementById('pair').value;
            const interval = document.getElementById('interval').value;
            const messageDiv = document.getElementById('messageDisplay');
            const statusDiv = document.getElementById('statusMessage');

            // éš”é®æ¬¢è¿·ä¼¼çš„éŒ¯èª¤æç¤º
            messageDiv.innerHTML = '<div class="status-badge loading">ğŸ”„ ä¸Šæ–‡é æ¸¬ä¸­...</div>';

            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ pair, interval })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    updatePrediction(data);
                    messageDiv.innerHTML = '<div class="success-message">âœ… é æ¸¬æˆåŠŸ!</div>';
                    statusDiv.innerHTML = '<div class="status-badge ok">âš¡ ç¹–ç²—</div>';
                } else {
                    messageDiv.innerHTML = `<div class="error-message">âŒ ${data.message}</div>`;
                    statusDiv.innerHTML = '<div class="status-badge error">âš  éŒ¯èª¤</div>';
                }
            } catch (error) {
                messageDiv.innerHTML = `<div class="error-message">âŒ ç¶­ç·ºéŒ¯èª¤: ${error.message}</div>`;
                statusDiv.innerHTML = '<div class="status-badge error">âš  é˜»ç´º</div>';
            }
        }

        // é–‹å§‹è‡ªå‹•æ›´æ–°
        function startAutoUpdate() {
            if (isAutoUpdating) return;

            isAutoUpdating = true;
            document.getElementById('autoUpdateStatus').textContent = '\u25b6 é©—ç­¡ä¸­';

            // ç¬¬ä¸€æ¬¡ç«‹å³é©—ç­¡
            predictNow();

            // ç„¶å¾Œæ¯ 60 ç§’æ›´æ–°ä¸€æ¬¡
            autoUpdateInterval = setInterval(() => {
                if (isAutoUpdating) {
                    predictNow();
                }
            }, 60000);
        }

        // åœæ­¢è‡ªå‹•æ›´æ–°
        function stopAutoUpdate() {
            isAutoUpdating = false;
            document.getElementById('autoUpdateStatus').textContent = '\u26a0 å·²åœæ­¢';

            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
                autoUpdateInterval = null;
            }
        }

        // é é¢åŠ è¼‰æ™‚é‡å§‹åŒ–
        window.onload = () => {
            updateTimestamp();

            // æ¯ç§’æ›´æ–°æ™‚é–“æˆ³
            setInterval(updateTimestamp, 1000);

            // ç°¡åŒ–ä¸Šæ¬¡æœ€æ–°é æ¸¬
            fetch('/api/latest')
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'success') {
                        updatePrediction(data);
                        document.getElementById('statusMessage').innerHTML = '<div class="status-badge ok">\u26a1 ç¹–ç²—</div>';
                    }
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('statusMessage').innerHTML = '<div class="status-badge error">\u26a0 éŒ¯èª¤</div>';
                });
        };
    </script>
</body>
</html>
